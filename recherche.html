<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recherche</title>
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@100;400;500;700;800;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style/style.css">
    <script src="//unpkg.com/jquery"></script>
    <!-- <script src="storage.js"></script> -->
    <script src="index.js"></script> 
</head>

<body>





    <header>

        <a href="index.html">
            <div class="logo">
                <h4>DEEZWEB</h4>
            </div>
        </a>

        <div class="menu">
            <a href="index.html">
                <div class="item-navigation">
                    <div>
                        <img class="picto-home" src="img/accueil.svg" alt="">
                    </div>
                    <div>
                        <p>
                            ACCUEIL
                        </p>
                    </div>
                </div>
            </a>

            <a href="recherche.html">
                <div class="item-navigation">
                    <div>
                        <img  class="picto-recherche" src="img/rechercher.svg" alt="">
                    </div>
                    <div>
                        <p>
                            RECHERCHER
                        </p>
                    </div>
                </div>
            </a>


            <a href="favoris.html">
                <div class="item-navigation">
                    <div>
                        <img class="picto-fav" src="img/favoris.svg" alt="">
                    </div>
                    <div>
                        <p>
                            FAVORIS
                        </p>
                    </div>
                </div>
            </a>

        </div>

    </header>




    <main>
        <div class="page-title">

            <h1>
                Recherche
            </h1>
            <p>
                Rechercher un titre sur Deezzer en utilisant le formulaire suivant :
            </p>


        </div>














        <form class="form-rechercher">
        <div>
            <label for="titre">Titre </label>
            <input id="titre" class="titre" type="search" name="titre" placeholder="Titre de votre musique..."/>
        </div>
            <div>
            <label for="trier">Trier </label>
            <select id="trier" name="trier" class="trier">
                <option value="ALBUM_ASC">Album</option>
                <option value="ARTIST_ASC" selected="selected">Artiste</option>
                <option value="TRACK_ASC">Titre</option>
                <option value="RATING_ASC">Popularité</option>
                <option value="RANKING">Rang</option>
            </select>
        </div>

        <div>
            
            <input id="go" type="submit" name="rechercher" value="Go">
        </div>

        </form>

        <div id="results"></div>



       
      
        <!-- <script>
            $(function () {
                'use strict';

                const result = $('#results');
                const goSearch = $('[name="rechercher"]');
                const searchedTitre = $('.titre');
                const sortBy = $('.trier');
                const favoris = [];
                const fav = $('#fav')

                //  Search on click   

                goSearch.on('click', onSearch);

                function onSearch(event) {
                    event.preventDefault()

                    let searchedTitreValue = searchedTitre.val();
                    searchedTitreValue = encodeURIComponent(searchedTitreValue);

                    let sortByValue = sortBy.val();
                    sortByValue = encodeURIComponent(sortByValue);

                    console.log(searchedTitreValue);


                    

                    const request = ($.ajax({
                        url: `https://api.deezer.com/search?q=${searchedTitreValue}&order=${sortByValue}&output=jsonp`,
                        dataType: "jsonp",
                    }));

                    request.done(onSuccess);
                    request.fail(onFail);
                }

                function onSuccess(results) {
                    result.empty();


                    console.log("Résultat :", results.data);
                    let listItem = [];
                    var tracksSearchArray = results.data;
                    let favorisTable = [];

 









                    $.each(tracksSearchArray, function (i, track) {

                        let ident = track.id;
                        let art = track.artist.name;
                        let tit = track.title;
                        let alb = track.album.title;
                        let cov = track.album.cover_small;
                        let prev = track.preview;

                        const trackObj = {ident, art, tit, alb, cov, prev};
                        // listItem.push(trackObj);


                        
                        

                        result.append(

                        `<div class="track">

                            <div class="media">
                                <div>
                                    <img src="${cov}" alt="">
                                </div>
                                <div>
                                    <h5>${art}</h5>
                                    <p>${tit}</p>
                                    <p>${alb}</p>
                                </div>
                            </div>

                            <div class="player">
                                <audio controls src=${prev}></audio>
                            </div>

                            <input type="button" value="Ajouter aux favoris" id="${ident}" class="btn-add-fav">

                        </div>`


                        );

                   
                    });

                    $('.btn-add-fav').one('click',function addTofavorite(e){
                                e.preventDefault;
                                let identity = this.id; 

                                for( let i = 0; i < tracksSearchArray.length; i++){
                                    if(tracksSearchArray[i].id == identity ){
                                        let ident = tracksSearchArray[i].id;
                                        let art = tracksSearchArray[i].artist.name;
                                        let tit = tracksSearchArray[i].title;
                                        let alb = tracksSearchArray[i].album.title;
                                        let cov = tracksSearchArray[i].album.cover_small;
                                        let prev = tracksSearchArray[i].preview;

                                        const trackFavObj = {ident, art, tit, alb, cov, prev};
                                        favorisTable.push(trackFavObj);

                               
                                        localStorage.setItem("deez-web", JSON.stringify(favorisTable));
                                        let storageVavoritsData = JSON.parse(localStorage.getItem("deez-web"));


                                        $.each(storageVavoritsData, function (j, track) {

                                            let ident = track.id;
                                            let art = track.artist.name;
                                            let tit = track.title;
                                            let alb = track.album.title;
                                            let cov = track.album.cover_small;
                                            let prev = track.preview;

                                            const trackObj = {ident, art, tit, alb, cov, prev};                                   

                                            fav.append(

                                            `<div class="track">

                                                <div class="media">
                                                    <div>
                                                        <img src="${cov}" alt="">
                                                    </div>
                                                    <div>
                                                        <h5>${art}</h5>
                                                        <p>${tit}</p>
                                                        <p>${alb}</p>
                                                    </div>
                                                </div>

                                                <div class="player">
                                                    <audio controls src=${prev}></audio>
                                                </div>

                                                <input type="button" value="Ajouter aux favoris" id="${ident}" class="btn-add-fav">

                                            </div>`

                                            );

                   
                    });

                                        
                                    
                            
                            
                            
                            
                                    }
                                }
                            // this.remove();

                                
                            console.log(identity) ; 
                            console.log(this) ;  
                            console.log(favorisTable);
                            // console.log(trackObj) ;                     
                    })



 

                }


  

                 


                
               


                function onFail(jqXHR) {
                    result.html(`<div class="alert alert-danger">
                                    Une erreur s'est produite : ${jqXHR.statusText}
                                </div>`);
                }

            });

        </script> -->

        </main>
</body>

</html>